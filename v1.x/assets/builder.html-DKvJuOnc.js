import{_ as s,c as a,a as e,o as p}from"./app-CTHVgaoT.js";const t={};function l(i,n){return p(),a("div",null,[...n[0]||(n[0]=[e(`<h1 id="客户端构建器" tabindex="-1"><a class="header-anchor" href="#客户端构建器"><span>客户端构建器</span></a></h1><p>Dify Java 客户端库使用构建器模式，使创建和配置与 Dify API 交互所需的各种客户端变得简单。若在非 SpringBoot 项目中或不想使用默认构造实例，可以使用下面的方法进行自定义构造。</p><h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><p>Dify 客户端库包含几个用于不同 API 端点的构建器：</p><ul><li><code>DifyChatBuilder</code> - 用于聊天相关操作</li><li><code>DifyDatasetBuilder</code> - 用于数据集操作</li><li><code>DifyWorkflowBuilder</code> - 用于工作流操作</li><li><code>DifyServerBuilder</code> - 用于服务器管理操作</li></ul><h2 id="使用构建器" tabindex="-1"><a class="header-anchor" href="#使用构建器"><span>使用构建器</span></a></h2><h3 id="基本用法" tabindex="-1"><a class="header-anchor" href="#基本用法"><span>基本用法</span></a></h3><p>创建客户端最快捷的方式是使用静态工厂方法：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token comment">// 使用默认设置创建聊天客户端</span></span>
<span class="line"><span class="token class-name">DifyChat</span> difyChat <span class="token operator">=</span> <span class="token class-name">DifyChatBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span></span>
<span class="line">                <span class="token class-name">DifyChatBuilder<span class="token punctuation">.</span>DifyChatClientBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 使用自定义基本 URL 创建聊天客户端</span></span>
<span class="line"><span class="token class-name">DifyChat</span> difyChat <span class="token operator">=</span> <span class="token class-name">DifyChatBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">DifyChatBuilder<span class="token punctuation">.</span>DifyChatClientBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;https://your-dify-api.example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用流式构建器-api" tabindex="-1"><a class="header-anchor" href="#使用流式构建器-api"><span>使用流式构建器 API</span></a></h3><p>要获得更多控制，可以使用流式构建器 API：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token class-name">DifyChat</span> difyChat <span class="token operator">=</span> <span class="token class-name">DifyChatBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">DifyChatBuilder<span class="token punctuation">.</span>DifyChatClientBuilder</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://your-dify-api.example.com&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">clientConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DifyProperties<span class="token punctuation">.</span>ClientConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="带身份验证的服务器客户端" tabindex="-1"><a class="header-anchor" href="#带身份验证的服务器客户端"><span>带身份验证的服务器客户端</span></a></h3><p>数据集客户端需要apiKey凭据：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"></span>
<span class="line"><span class="token class-name">DifyDataset</span> difyDataset <span class="token operator">=</span> <span class="token class-name">DifyDatasetBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">DifyDatasetBuilder<span class="token punctuation">.</span>DifyDatasetClientBuilder</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://custom-dify-api.example.com&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">apiKey</span><span class="token punctuation">(</span>&#39;ak<span class="token operator">-</span>aaaa&#39;<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>服务器客户端需要身份验证凭据：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token class-name">DifyProperties<span class="token punctuation">.</span>Server</span> serverProps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DifyProperties<span class="token punctuation">.</span>Server</span><span class="token punctuation">(</span><span class="token string">&quot;admin@example.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name">DifyServer</span> difyServer <span class="token operator">=</span> <span class="token class-name">DifyServerBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">DifyServerBuilder<span class="token punctuation">.</span>DifyServerClientBuilder</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">serverProperties</span><span class="token punctuation">(</span>serverProps<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="通用配置选项" tabindex="-1"><a class="header-anchor" href="#通用配置选项"><span>通用配置选项</span></a></h2><p>所有构建器都支持这些通用配置选项：</p><ul><li><code>baseUrl(String)</code> - 设置 Dify API 的基本 URL</li><li><code>clientConfig(DifyProperties.ClientConfig)</code> - 配置客户端行为，如超时、重试策略等</li><li><code>restClientBuilder(RestClient.Builder)</code> - 提供自定义的 Spring RestClient 构建器</li><li><code>webClientBuilder(WebClient.Builder)</code> - 提供自定义的 Spring WebClient 构建器</li></ul><h2 id="高级用法" tabindex="-1"><a class="header-anchor" href="#高级用法"><span>高级用法</span></a></h2><h3 id="自定义-http-客户端" tabindex="-1"><a class="header-anchor" href="#自定义-http-客户端"><span>自定义 HTTP 客户端</span></a></h3><p>您可以自定义 Dify 客户端使用的 HTTP 客户端：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token comment">// 配置具有特殊设置的自定义 RestClient</span></span>
<span class="line"><span class="token class-name">RestClient<span class="token punctuation">.</span>Builder</span> customRestClientBuilder <span class="token operator">=</span> <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">requestFactory</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">defaultHeaders</span><span class="token punctuation">(</span>headers <span class="token operator">-&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">                    headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Custom-Header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name">DifyDataset</span> difyDataset <span class="token operator">=</span> <span class="token class-name">DifyDatasetBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">DifyDatasetBuilder<span class="token punctuation">.</span>DifyDatasetClientBuilder</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">restClientBuilder</span><span class="token punctuation">(</span>customRestClientBuilder<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="设置客户端配置" tabindex="-1"><a class="header-anchor" href="#设置客户端配置"><span>设置客户端配置</span></a></h3><p>您可以配置客户端的行为方式：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token comment">// 配置客户端行为</span></span>
<span class="line"><span class="token class-name">DifyProperties<span class="token punctuation">.</span>ClientConfig</span> clientConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DifyProperties<span class="token punctuation">.</span>ClientConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">clientConfig<span class="token punctuation">.</span></span>
<span class="line"></span>
<span class="line"><span class="token function">setSkipNull</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name">DifyWorkflow</span> difyWorkflow <span class="token operator">=</span> <span class="token class-name">DifyWorkflowBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">DifyWorkflowBuilder<span class="token punctuation">.</span>DifyWorkflowClientBuilder</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">clientConfig</span><span class="token punctuation">(</span>clientConfig<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="示例-完整配置" tabindex="-1"><a class="header-anchor" href="#示例-完整配置"><span>示例：完整配置</span></a></h2><p>以下是完整配置的示例：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token class-name">DifyServer</span> difyServer <span class="token operator">=</span> <span class="token class-name">DifyServerBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token class-name">DifyServerBuilder<span class="token punctuation">.</span>DifyServerClientBuilder</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://your-dify-api.example.com&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">serverProperties</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DifyProperties<span class="token punctuation">.</span>Server</span><span class="token punctuation">(</span><span class="token string">&quot;admin@example.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">serverToken</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DifyServerTokenDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">clientConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DifyProperties<span class="token punctuation">.</span>ClientConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">restClientBuilder</span><span class="token punctuation">(</span><span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">webClientBuilder</span><span class="token punctuation">(</span><span class="token class-name">WebClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h2><ul><li>整体使用没有差别，但是在 springboot2环境下，没有 RestClient，只有 WebClient</li></ul>`,32)])])}const o=s(t,[["render",l]]),u=JSON.parse('{"path":"/guide/builder.html","title":"客户端构建器","lang":"zh-cn","frontmatter":{"lang":"zh-cn","title":"客户端构建器","description":null},"git":{"updatedTime":1755149231000,"contributors":[{"name":"yanghq","username":"yanghq","email":"1040926235@qq.com","commits":3,"url":"https://github.com/yanghq"}],"changelog":[{"hash":"e10508d8eef2de10a1806f171fb2023221c2694d","time":1755149231000,"email":"1040926235@qq.com","author":"yanghq","message":"feat: change document status"},{"hash":"102cdf2c6e1a99b92330b4e253e16c2fae472430","time":1755084380000,"email":"1040926235@qq.com","author":"yanghq","message":"doc: DifyDatasetBuilder expand apikey"},{"hash":"c92291bec9a79fb6308b7423ac6fc0f725bc774b","time":1744946377000,"email":"1040926235@qq.com","author":"yanghq","message":"doc: support builder"}]},"filePathRelative":"guide/builder.md"}');export{o as comp,u as data};
