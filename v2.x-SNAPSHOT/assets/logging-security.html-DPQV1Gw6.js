import{_ as l,c as i,a as o,b as s,e,w as t,r as c,o as u,d as p}from"./app-BskTWXfy.js";const r={};function d(k,n){const a=c("RouteLink");return u(),i("div",null,[n[3]||(n[3]=o(`<h1 id="æ—¥å¿—å®‰å…¨" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—å®‰å…¨"><span>æ—¥å¿—å®‰å…¨</span></a></h1><h2 id="æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°"><span>æ¦‚è¿°</span></a></h2><p>ä¸ºäº†ä¿æŠ¤æ•æ„Ÿä¿¡æ¯ä¸è¢«æ³„éœ²åˆ°æ—¥å¿—ä¸­ï¼Œdify-spring-boot-starter æä¾›äº†å®Œå–„çš„æ—¥å¿—è„±æ•åŠŸèƒ½ã€‚è¯¥åŠŸèƒ½é»˜è®¤å¯ç”¨ï¼Œå¯ä»¥è‡ªåŠ¨è¯†åˆ«å¹¶è„±æ•æ•æ„Ÿæ•°æ®ï¼ŒåŒ…æ‹¬ API Keyã€Tokenã€å¯†ç ã€Cookies ç­‰ã€‚</p><p>åŒæ—¶ï¼Œæ¡†æ¶è¿˜æä¾›äº† SSEï¼ˆServer-Sent Eventsï¼‰æµå¼å“åº”çš„å®‰å…¨ä¿æŠ¤ï¼Œé¿å…å› æ—¥å¿—è®°å½•å¯¼è‡´çš„æµå¼å“åº”é˜»å¡é—®é¢˜ã€‚</p><h2 id="åŠŸèƒ½ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#åŠŸèƒ½ç‰¹æ€§"><span>åŠŸèƒ½ç‰¹æ€§</span></a></h2><h3 id="ğŸ”’-æ•æ„Ÿä¿¡æ¯è„±æ•" tabindex="-1"><a class="header-anchor" href="#ğŸ”’-æ•æ„Ÿä¿¡æ¯è„±æ•"><span>ğŸ”’ æ•æ„Ÿä¿¡æ¯è„±æ•</span></a></h3><p>è‡ªåŠ¨è„±æ•ä»¥ä¸‹ç±»å‹çš„æ•æ„Ÿä¿¡æ¯ï¼š</p><ol><li><p><strong>HTTP Headers</strong></p><ul><li><code>Authorization</code></li><li><code>Cookie</code></li><li><code>Token</code></li><li><code>API-Key</code> / <code>ApiKey</code></li><li>å…¶ä»–åŒ…å«æ•æ„Ÿå…³é”®è¯çš„ header</li></ul></li><li><p><strong>URL å‚æ•°</strong></p><ul><li><code>api_key</code> / <code>apikey</code></li><li><code>token</code></li><li><code>authorization</code></li><li><code>password</code></li><li><code>secret</code></li><li><code>access_token</code></li><li><code>refresh_token</code></li></ul></li><li><p><strong>Cookies</strong></p><ul><li>æ‰€æœ‰ cookies åœ¨æ—¥å¿—ä¸­æ˜¾ç¤ºä¸º <code>***MASKED***</code></li></ul></li><li><p><strong>è¯·æ±‚/å“åº” Body</strong></p><ul><li>ä½¿ç”¨æ™ºèƒ½ MaskingEngine è¯†åˆ«å¹¶è„±æ•æ•æ„Ÿå­—æ®µ</li><li>æ”¯æŒ JSONã€è¡¨å•æ•°æ®ç­‰å¤šç§æ ¼å¼</li></ul></li></ol><h3 id="ğŸš€-sse-æµå¼å“åº”ä¿æŠ¤" tabindex="-1"><a class="header-anchor" href="#ğŸš€-sse-æµå¼å“åº”ä¿æŠ¤"><span>ğŸš€ SSE æµå¼å“åº”ä¿æŠ¤</span></a></h3><ul><li>è‡ªåŠ¨æ£€æµ‹ <code>Content-Type: text/event-stream</code> å“åº”</li><li>SSE å“åº”åªè®°å½• headersï¼Œä¸è¯»å– body</li><li>é¿å…å› æ—¥å¿—è®°å½•å¯¼è‡´çš„æµå¼æ¶ˆè´¹é˜»å¡</li><li>é˜²æ­¢å†…å­˜æº¢å‡ºå’Œè¿æ¥è¶…æ—¶</li></ul><h2 id="é…ç½®è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#é…ç½®è¯´æ˜"><span>é…ç½®è¯´æ˜</span></a></h2><h3 id="spring-boot-é…ç½®" tabindex="-1"><a class="header-anchor" href="#spring-boot-é…ç½®"><span>Spring Boot é…ç½®</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">dify</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">client-config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">logging</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>                    <span class="token comment"># å¯ç”¨æ—¥å¿—è®°å½•ï¼Œé»˜è®¤ true</span></span>
<span class="line">    <span class="token key atrule">logging-mask-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>       <span class="token comment"># å¯ç”¨æ—¥å¿—è„±æ•ï¼Œé»˜è®¤ true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="çº¯-java-é…ç½®" tabindex="-1"><a class="header-anchor" href="#çº¯-java-é…ç½®"><span>çº¯ Java é…ç½®</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>guoshiqiufeng<span class="token punctuation">.</span>dify<span class="token punctuation">.</span>core<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">DifyProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>guoshiqiufeng<span class="token punctuation">.</span>dify<span class="token punctuation">.</span>client<span class="token punctuation">.</span>integration<span class="token punctuation">.</span>okhttp<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">JavaHttpClientFactory</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>guoshiqiufeng<span class="token punctuation">.</span>dify<span class="token punctuation">.</span>client<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span></span><span class="token class-name">JacksonJsonMapper</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åˆ›å»ºå®¢æˆ·ç«¯é…ç½®</span></span>
<span class="line"><span class="token class-name">DifyProperties<span class="token punctuation">.</span>ClientConfig</span> clientConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DifyProperties<span class="token punctuation">.</span>ClientConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">clientConfig<span class="token punctuation">.</span><span class="token function">setLogging</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// å¯ç”¨æ—¥å¿—</span></span>
<span class="line">clientConfig<span class="token punctuation">.</span><span class="token function">setLoggingMaskEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// å¯ç”¨è„±æ•ï¼ˆé»˜è®¤å€¼ï¼‰</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åˆ›å»º HTTP å®¢æˆ·ç«¯å·¥å‚</span></span>
<span class="line"><span class="token class-name">JavaHttpClientFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JavaHttpClientFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JacksonJsonMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åˆ›å»ºå®¢æˆ·ç«¯</span></span>
<span class="line"><span class="token class-name">DifyChatClient</span> client <span class="token operator">=</span> <span class="token class-name">DifyChatBuilder</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.dify.ai&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">clientConfig</span><span class="token punctuation">(</span>clientConfig<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">httpClientFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="é…ç½®å‚æ•°" tabindex="-1"><a class="header-anchor" href="#é…ç½®å‚æ•°"><span>é…ç½®å‚æ•°</span></a></h2><h3 id="logging" tabindex="-1"><a class="header-anchor" href="#logging"><span>logging</span></a></h3><ul><li><strong>ç±»å‹</strong>ï¼š<code>Boolean</code></li><li><strong>é»˜è®¤å€¼</strong>ï¼š<code>true</code></li><li><strong>è¯´æ˜</strong>ï¼šæ˜¯å¦å¯ç”¨æ—¥å¿—è®°å½•ã€‚éœ€è¦é…åˆæ—¥å¿—çº§åˆ« <code>DEBUG</code> ä½¿ç”¨ã€‚</li></ul><h3 id="loggingmaskenabled" tabindex="-1"><a class="header-anchor" href="#loggingmaskenabled"><span>loggingMaskEnabled</span></a></h3><ul><li><strong>ç±»å‹</strong>ï¼š<code>Boolean</code></li><li><strong>é»˜è®¤å€¼</strong>ï¼š<code>true</code></li><li><strong>è¯´æ˜</strong>ï¼šæ˜¯å¦å¯ç”¨æ—¥å¿—è„±æ•ã€‚å»ºè®®ç”Ÿäº§ç¯å¢ƒä¿æŒå¯ç”¨ä»¥ä¿æŠ¤æ•æ„Ÿä¿¡æ¯ã€‚</li></ul><h2 id="ä½¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹"><span>ä½¿ç”¨ç¤ºä¾‹</span></a></h2><h3 id="ç¤ºä¾‹-1-é»˜è®¤é…ç½®-æ¨è" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-é»˜è®¤é…ç½®-æ¨è"><span>ç¤ºä¾‹ 1ï¼šé»˜è®¤é…ç½®ï¼ˆæ¨èï¼‰</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">dify</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//api.dify.ai</span>
<span class="line">  <span class="token key atrule">client-config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">logging</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">logging-mask-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># é»˜è®¤å¯ç”¨ï¼Œå¯çœç•¥</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ—¥å¿—è¾“å‡ºç¤ºä¾‹ï¼š</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">ã€Difyã€‘Request: POST https://api.dify.ai/v1/chat-messages?api_key=***MASKED***</span>
<span class="line">ã€Difyã€‘Request Headers: {Authorization: ***MASKED***, Content-Type: application/json}</span>
<span class="line">ã€Difyã€‘Request Body: {&quot;query&quot;:&quot;ä½ å¥½&quot;,&quot;user&quot;:&quot;user-123&quot;}</span>
<span class="line">ã€Difyã€‘Response: 200 OK (123ms)</span>
<span class="line">ã€Difyã€‘Response Headers: {Content-Type: application/json}</span>
<span class="line">ã€Difyã€‘Response Body: {&quot;answer&quot;:&quot;ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ&quot;}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¤ºä¾‹-2-è°ƒè¯•æ¨¡å¼-å…³é—­è„±æ•" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-è°ƒè¯•æ¨¡å¼-å…³é—­è„±æ•"><span>ç¤ºä¾‹ 2ï¼šè°ƒè¯•æ¨¡å¼ï¼ˆå…³é—­è„±æ•ï¼‰</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">dify</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//api.dify.ai</span>
<span class="line">  <span class="token key atrule">client-config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">logging</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">logging-mask-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token comment"># å…³é—­è„±æ•ï¼Œç”¨äºè°ƒè¯•</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ—¥å¿—è¾“å‡ºç¤ºä¾‹ï¼š</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">ã€Difyã€‘Request: POST https://api.dify.ai/v1/chat-messages?api_key=app-abc123def456</span>
<span class="line">ã€Difyã€‘Request Headers: {Authorization: Bearer app-abc123def456, Content-Type: application/json}</span>
<span class="line">ã€Difyã€‘Request Body: {&quot;query&quot;:&quot;ä½ å¥½&quot;,&quot;user&quot;:&quot;user-123&quot;}</span>
<span class="line">ã€Difyã€‘Response: 200 OK (123ms)</span>
<span class="line">ã€Difyã€‘Response Headers: {Content-Type: application/json}</span>
<span class="line">ã€Difyã€‘Response Body: {&quot;answer&quot;:&quot;ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ&quot;}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¤ºä¾‹-3-sse-æµå¼å“åº”" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-3-sse-æµå¼å“åº”"><span>ç¤ºä¾‹ 3ï¼šSSE æµå¼å“åº”</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">dify</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//api.dify.ai</span>
<span class="line">  <span class="token key atrule">client-config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">logging</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">logging-mask-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ—¥å¿—è¾“å‡ºç¤ºä¾‹ï¼š</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">ã€Difyã€‘Request: POST https://api.dify.ai/v1/chat-messages</span>
<span class="line">ã€Difyã€‘Request Headers: {Authorization: ***MASKED***, Content-Type: application/json}</span>
<span class="line">ã€Difyã€‘Request Body: {&quot;query&quot;:&quot;ä½ å¥½&quot;,&quot;response_mode&quot;:&quot;streaming&quot;,&quot;user&quot;:&quot;user-123&quot;}</span>
<span class="line">ã€Difyã€‘Response: 200 OK (45ms)</span>
<span class="line">ã€Difyã€‘Response Headers: {Content-Type: text/event-stream}</span>
<span class="line">ã€Difyã€‘SSE response detected, skipping body logging to avoid blocking stream</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ—¥å¿—çº§åˆ«é…ç½®" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—çº§åˆ«é…ç½®"><span>æ—¥å¿—çº§åˆ«é…ç½®</span></a></h2><p>è¦å¯ç”¨æ—¥å¿—è¾“å‡ºï¼Œéœ€è¦é…ç½®æ—¥å¿—çº§åˆ«ä¸º <code>DEBUG</code>ï¼š</p><h3 id="logback-é…ç½®-spring-boot-é»˜è®¤" tabindex="-1"><a class="header-anchor" href="#logback-é…ç½®-spring-boot-é»˜è®¤"><span>Logback é…ç½®ï¼ˆSpring Boot é»˜è®¤ï¼‰</span></a></h3><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml"><pre><code class="language-xml"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.github.guoshiqiufeng.dify.client<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="application-yml-é…ç½®" tabindex="-1"><a class="header-anchor" href="#application-yml-é…ç½®"><span>application.yml é…ç½®</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">logging</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">level</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">io.github.guoshiqiufeng.dify.client</span><span class="token punctuation">:</span> DEBUG</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="log4j2-é…ç½®" tabindex="-1"><a class="header-anchor" href="#log4j2-é…ç½®"><span>Log4j2 é…ç½®</span></a></h3><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml"><pre><code class="language-xml"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Loggers</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.github.guoshiqiufeng.dify.client<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Loggers</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å®‰å…¨æœ€ä½³å®è·µ" tabindex="-1"><a class="header-anchor" href="#å®‰å…¨æœ€ä½³å®è·µ"><span>å®‰å…¨æœ€ä½³å®è·µ</span></a></h2><h3 id="_1-ç”Ÿäº§ç¯å¢ƒé…ç½®" tabindex="-1"><a class="header-anchor" href="#_1-ç”Ÿäº§ç¯å¢ƒé…ç½®"><span>1. ç”Ÿäº§ç¯å¢ƒé…ç½®</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">dify</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">client-config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">logging</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>                    <span class="token comment"># å¯ç”¨æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥</span></span>
<span class="line">    <span class="token key atrule">logging-mask-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>       <span class="token comment"># å¿…é¡»å¯ç”¨è„±æ•ï¼Œä¿æŠ¤æ•æ„Ÿä¿¡æ¯</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-å¼€å‘ç¯å¢ƒé…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-å¼€å‘ç¯å¢ƒé…ç½®"><span>2. å¼€å‘ç¯å¢ƒé…ç½®</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">dify</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">client-config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">logging</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">logging-mask-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>      <span class="token comment"># å¯ä»¥å…³é—­è„±æ•ï¼Œä¾¿äºè°ƒè¯•</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-æ—¥å¿—çº§åˆ«å»ºè®®" tabindex="-1"><a class="header-anchor" href="#_3-æ—¥å¿—çº§åˆ«å»ºè®®"><span>3. æ—¥å¿—çº§åˆ«å»ºè®®</span></a></h3><ul><li><strong>ç”Ÿäº§ç¯å¢ƒ</strong>ï¼š<code>INFO</code> æˆ– <code>WARN</code>ï¼ˆä¸è¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼‰</li><li><strong>æµ‹è¯•ç¯å¢ƒ</strong>ï¼š<code>DEBUG</code>ï¼ˆè¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼Œå¯ç”¨è„±æ•ï¼‰</li><li><strong>å¼€å‘ç¯å¢ƒ</strong>ï¼š<code>DEBUG</code>ï¼ˆè¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼Œå¯é€‰æ‹©æ€§å…³é—­è„±æ•ï¼‰</li></ul><h3 id="_4-æ•æ„Ÿä¿¡æ¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_4-æ•æ„Ÿä¿¡æ¯å¤„ç†"><span>4. æ•æ„Ÿä¿¡æ¯å¤„ç†</span></a></h3><ul><li>âœ… <strong>æ¨è</strong>ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®ä¸­å¿ƒç®¡ç† API Key</li><li>âœ… <strong>æ¨è</strong>ï¼šå¯ç”¨æ—¥å¿—è„±æ•åŠŸèƒ½</li><li>âœ… <strong>æ¨è</strong>ï¼šå®šæœŸå®¡æŸ¥æ—¥å¿—è¾“å‡ºï¼Œç¡®ä¿æ— æ•æ„Ÿä¿¡æ¯æ³„éœ²</li><li>âŒ <strong>é¿å…</strong>ï¼šåœ¨ä»£ç ä¸­ç¡¬ç¼–ç  API Key</li><li>âŒ <strong>é¿å…</strong>ï¼šå°†åŒ…å«æ•æ„Ÿä¿¡æ¯çš„æ—¥å¿—æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ</li></ul><h2 id="æŠ€æœ¯å®ç°" tabindex="-1"><a class="header-anchor" href="#æŠ€æœ¯å®ç°"><span>æŠ€æœ¯å®ç°</span></a></h2><h3 id="è„±æ•æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#è„±æ•æœºåˆ¶"><span>è„±æ•æœºåˆ¶</span></a></h3><p>æ¡†æ¶ä½¿ç”¨ <code>MaskingEngine</code> è¿›è¡Œæ™ºèƒ½è„±æ•ï¼š</p><ol><li><strong>Header è„±æ•</strong>ï¼šæ£€æµ‹ header åç§°ï¼ŒåŒ¹é…æ•æ„Ÿå…³é”®è¯åˆ™è„±æ•</li><li><strong>URL å‚æ•°è„±æ•</strong>ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ•æ„Ÿå‚æ•°å</li><li><strong>Body è„±æ•</strong>ï¼šä½¿ç”¨è½»é‡çº§ Tokenizer è§£æ JSON/è¡¨å•æ•°æ®ï¼Œè¯†åˆ«æ•æ„Ÿå­—æ®µ</li></ol><h3 id="sse-æ£€æµ‹" tabindex="-1"><a class="header-anchor" href="#sse-æ£€æµ‹"><span>SSE æ£€æµ‹</span></a></h3><p>é€šè¿‡æ£€æµ‹ <code>Content-Type</code> header åˆ¤æ–­æ˜¯å¦ä¸º SSE å“åº”ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isSseResponse</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span> contentType<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>contentType <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>contentType<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;event-stream&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>contentType<span class="token punctuation">.</span><span class="token function">subtype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€§èƒ½å½±å“" tabindex="-1"><a class="header-anchor" href="#æ€§èƒ½å½±å“"><span>æ€§èƒ½å½±å“</span></a></h3><ul><li>æ—¥å¿—è„±æ•ä»…åœ¨ <code>DEBUG</code> çº§åˆ«ç”Ÿæ•ˆ</li><li>ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ <code>INFO</code> çº§åˆ«æ—¶ï¼Œè„±æ•é€»è¾‘ä¸ä¼šæ‰§è¡Œ</li><li>è„±æ•æ“ä½œä½¿ç”¨é«˜æ•ˆçš„æ­£åˆ™è¡¨è¾¾å¼å’Œå­—ç¬¦ä¸²æ“ä½œï¼Œæ€§èƒ½å½±å“å¯å¿½ç•¥</li></ul><h2 id="å¸¸è§é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å¸¸è§é—®é¢˜"><span>å¸¸è§é—®é¢˜</span></a></h2><h3 id="q1-å¦‚ä½•ä¸´æ—¶å…³é—­è„±æ•è¿›è¡Œè°ƒè¯•" tabindex="-1"><a class="header-anchor" href="#q1-å¦‚ä½•ä¸´æ—¶å…³é—­è„±æ•è¿›è¡Œè°ƒè¯•"><span>Q1: å¦‚ä½•ä¸´æ—¶å…³é—­è„±æ•è¿›è¡Œè°ƒè¯•ï¼Ÿ</span></a></h3><p><strong>A:</strong> åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® <code>logging-mask-enabled: false</code>ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">dify</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">client-config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">logging-mask-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="q2-è„±æ•ä¼šå½±å“å®é™…çš„-api-è°ƒç”¨å—" tabindex="-1"><a class="header-anchor" href="#q2-è„±æ•ä¼šå½±å“å®é™…çš„-api-è°ƒç”¨å—"><span>Q2: è„±æ•ä¼šå½±å“å®é™…çš„ API è°ƒç”¨å—ï¼Ÿ</span></a></h3><p><strong>A:</strong> ä¸ä¼šã€‚è„±æ•åªå½±å“æ—¥å¿—è¾“å‡ºï¼Œä¸ä¼šä¿®æ”¹å®é™…çš„è¯·æ±‚å’Œå“åº”æ•°æ®ã€‚</p><h3 id="q3-å¦‚ä½•è‡ªå®šä¹‰è„±æ•è§„åˆ™" tabindex="-1"><a class="header-anchor" href="#q3-å¦‚ä½•è‡ªå®šä¹‰è„±æ•è§„åˆ™"><span>Q3: å¦‚ä½•è‡ªå®šä¹‰è„±æ•è§„åˆ™ï¼Ÿ</span></a></h3><p><strong>A:</strong> å½“å‰ç‰ˆæœ¬ä½¿ç”¨å†…ç½®çš„è„±æ•è§„åˆ™ã€‚å¦‚éœ€è‡ªå®šä¹‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>LogMaskingUtils.createEngine()</code> åˆ›å»ºè‡ªå®šä¹‰ MaskingEngineï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>guoshiqiufeng<span class="token punctuation">.</span>dify<span class="token punctuation">.</span>core<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>masking<span class="token punctuation">.</span></span><span class="token class-name">MaskingConfig</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>guoshiqiufeng<span class="token punctuation">.</span>dify<span class="token punctuation">.</span>core<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>masking<span class="token punctuation">.</span></span><span class="token class-name">MaskingEngine</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name">MaskingConfig</span> config <span class="token operator">=</span> <span class="token class-name">MaskingConfig</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">addSensitiveField</span><span class="token punctuation">(</span><span class="token string">&quot;custom_field&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">maxBodyLength</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name">MaskingEngine</span> engine <span class="token operator">=</span> <span class="token class-name">LogMaskingUtils</span><span class="token punctuation">.</span><span class="token function">createEngine</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="q4-sse-å“åº”ä¸ºä»€ä¹ˆä¸è®°å½•-body" tabindex="-1"><a class="header-anchor" href="#q4-sse-å“åº”ä¸ºä»€ä¹ˆä¸è®°å½•-body"><span>Q4: SSE å“åº”ä¸ºä»€ä¹ˆä¸è®°å½• bodyï¼Ÿ</span></a></h3><p><strong>A:</strong> SSE æ˜¯æµå¼å“åº”ï¼Œå¦‚æœè¯»å– body ä¼šé˜»å¡æµçš„æ¶ˆè´¹ï¼Œå¯¼è‡´ï¼š</p><ul><li>å®¢æˆ·ç«¯æ— æ³•å®æ—¶æ¥æ”¶æ•°æ®</li><li>å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºï¼ˆå¤§å‹æµå¼å“åº”ï¼‰</li><li>è¿æ¥è¶…æ—¶</li></ul><p>å› æ­¤ï¼ŒSSE å“åº”åªè®°å½• headersï¼Œä¸è¯»å– bodyã€‚</p><h3 id="q5-å¦‚ä½•éªŒè¯è„±æ•åŠŸèƒ½æ˜¯å¦ç”Ÿæ•ˆ" tabindex="-1"><a class="header-anchor" href="#q5-å¦‚ä½•éªŒè¯è„±æ•åŠŸèƒ½æ˜¯å¦ç”Ÿæ•ˆ"><span>Q5: å¦‚ä½•éªŒè¯è„±æ•åŠŸèƒ½æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ</span></a></h3><p><strong>A:</strong></p><ol><li>é…ç½®æ—¥å¿—çº§åˆ«ä¸º <code>DEBUG</code></li><li>å¯ç”¨ <code>logging-mask-enabled: true</code></li><li>å‘èµ·åŒ…å«æ•æ„Ÿä¿¡æ¯çš„è¯·æ±‚</li><li>æ£€æŸ¥æ—¥å¿—è¾“å‡ºï¼Œæ•æ„Ÿä¿¡æ¯åº”æ˜¾ç¤ºä¸º <code>***MASKED***</code></li></ol><h2 id="ç‰ˆæœ¬å†å²" tabindex="-1"><a class="header-anchor" href="#ç‰ˆæœ¬å†å²"><span>ç‰ˆæœ¬å†å²</span></a></h2><ul><li><strong>v2.1.0</strong>ï¼šå¢å¼ºæ—¥å¿—è„±æ•åŠŸèƒ½ï¼Œæ·»åŠ  SSE å®‰å…¨ä¿æŠ¤</li><li><strong>v2.0.0</strong>ï¼šå¼•å…¥ MaskingEngineï¼Œæ”¯æŒæ™ºèƒ½è„±æ•</li><li><strong>v1.x</strong>ï¼šåŸºç¡€æ—¥å¿—è®°å½•åŠŸèƒ½</li></ul><h2 id="ç›¸å…³æ–‡æ¡£" tabindex="-1"><a class="header-anchor" href="#ç›¸å…³æ–‡æ¡£"><span>ç›¸å…³æ–‡æ¡£</span></a></h2>`,78)),s("ul",null,[s("li",null,[e(a,{to:"/guide/introduction.html"},{default:t(()=>[...n[0]||(n[0]=[p("ä½¿ç”¨é…ç½®",-1)])]),_:1})]),s("li",null,[e(a,{to:"/config/custom.html"},{default:t(()=>[...n[1]||(n[1]=[p("è‡ªå®šä¹‰é…ç½®",-1)])]),_:1})]),s("li",null,[e(a,{to:"/guide/status.html"},{default:t(()=>[...n[2]||(n[2]=[p("çŠ¶æ€ç›‘æ§",-1)])]),_:1})])])])}const m=l(r,[["render",d]]),h=JSON.parse('{"path":"/guide/logging-security.html","title":"æ—¥å¿—å®‰å…¨","lang":"zh-CN","frontmatter":{"lang":"zh-CN","title":"æ—¥å¿—å®‰å…¨","description":"æ—¥å¿—è„±æ•ä¸ SSE å®‰å…¨åŠ å›º"},"git":{"updatedTime":1770264311000,"contributors":[{"name":"yanghq","username":"yanghq","email":"1040926235@qq.com","commits":1,"url":"https://github.com/yanghq"}],"changelog":[{"hash":"2830fb5d387ebe512bd2d863af74247b19bdea1f","time":1770264311000,"email":"1040926235@qq.com","author":"yanghq","message":"feat(security): enhance log masking and SSE safety"}]},"filePathRelative":"guide/logging-security.md"}');export{m as comp,h as data};
