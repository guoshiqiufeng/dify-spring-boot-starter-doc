import{_ as o,c as l,a as p,b as s,e,w as t,r as c,o as u,d as i}from"./app-BskTWXfy.js";const r={};function d(g,n){const a=c("RouteLink");return u(),l("div",null,[n[3]||(n[3]=p(`<h1 id="logging-security" tabindex="-1"><a class="header-anchor" href="#logging-security"><span>Logging Security</span></a></h1><h2 id="overview" tabindex="-1"><a class="header-anchor" href="#overview"><span>Overview</span></a></h2><p>To protect sensitive information from being leaked into logs, dify-spring-boot-starter provides comprehensive log masking functionality. This feature is enabled by default and can automatically identify and mask sensitive data, including API Keys, Tokens, passwords, Cookies, etc.</p><p>Additionally, the framework provides security protection for SSE (Server-Sent Events) streaming responses to avoid blocking issues caused by log recording.</p><h2 id="features" tabindex="-1"><a class="header-anchor" href="#features"><span>Features</span></a></h2><h3 id="üîí-sensitive-information-masking" tabindex="-1"><a class="header-anchor" href="#üîí-sensitive-information-masking"><span>üîí Sensitive Information Masking</span></a></h3><p>Automatically masks the following types of sensitive information:</p><ol><li><p><strong>HTTP Headers</strong></p><ul><li><code>Authorization</code></li><li><code>Cookie</code></li><li><code>Token</code></li><li><code>API-Key</code> / <code>ApiKey</code></li><li>Other headers containing sensitive keywords</li></ul></li><li><p><strong>URL Parameters</strong></p><ul><li><code>api_key</code> / <code>apikey</code></li><li><code>token</code></li><li><code>authorization</code></li><li><code>password</code></li><li><code>secret</code></li><li><code>access_token</code></li><li><code>refresh_token</code></li></ul></li><li><p><strong>Cookies</strong></p><ul><li>All cookies are displayed as <code>***MASKED***</code> in logs</li></ul></li><li><p><strong>Request/Response Body</strong></p><ul><li>Uses intelligent MaskingEngine to identify and mask sensitive fields</li><li>Supports multiple formats including JSON, form data, etc.</li></ul></li></ol><h3 id="üöÄ-sse-streaming-response-protection" tabindex="-1"><a class="header-anchor" href="#üöÄ-sse-streaming-response-protection"><span>üöÄ SSE Streaming Response Protection</span></a></h3><ul><li>Automatically detects <code>Content-Type: text/event-stream</code> responses</li><li>SSE responses only log headers, not body</li><li>Avoids blocking streaming consumption due to log recording</li><li>Prevents memory overflow and connection timeout</li></ul><h2 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration"><span>Configuration</span></a></h2><h3 id="spring-boot-configuration" tabindex="-1"><a class="header-anchor" href="#spring-boot-configuration"><span>Spring Boot Configuration</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">dify</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">client-config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">logging</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>                    <span class="token comment"># Enable logging, default true</span></span>
<span class="line">    <span class="token key atrule">logging-mask-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>       <span class="token comment"># Enable log masking, default true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="pure-java-configuration" tabindex="-1"><a class="header-anchor" href="#pure-java-configuration"><span>Pure Java Configuration</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>guoshiqiufeng<span class="token punctuation">.</span>dify<span class="token punctuation">.</span>core<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">DifyProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>guoshiqiufeng<span class="token punctuation">.</span>dify<span class="token punctuation">.</span>client<span class="token punctuation">.</span>integration<span class="token punctuation">.</span>okhttp<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">JavaHttpClientFactory</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>guoshiqiufeng<span class="token punctuation">.</span>dify<span class="token punctuation">.</span>client<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span></span><span class="token class-name">JacksonJsonMapper</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Create client configuration</span></span>
<span class="line"><span class="token class-name">DifyProperties<span class="token punctuation">.</span>ClientConfig</span> clientConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DifyProperties<span class="token punctuation">.</span>ClientConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">clientConfig<span class="token punctuation">.</span><span class="token function">setLogging</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// Enable logging</span></span>
<span class="line">clientConfig<span class="token punctuation">.</span><span class="token function">setLoggingMaskEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// Enable masking (default)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Create HTTP client factory</span></span>
<span class="line"><span class="token class-name">JavaHttpClientFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JavaHttpClientFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JacksonJsonMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Create client</span></span>
<span class="line"><span class="token class-name">DifyChatClient</span> client <span class="token operator">=</span> <span class="token class-name">DifyChatBuilder</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.dify.ai&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">clientConfig</span><span class="token punctuation">(</span>clientConfig<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">httpClientFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="configuration-parameters" tabindex="-1"><a class="header-anchor" href="#configuration-parameters"><span>Configuration Parameters</span></a></h2><h3 id="logging" tabindex="-1"><a class="header-anchor" href="#logging"><span>logging</span></a></h3><ul><li><strong>Type</strong>: <code>Boolean</code></li><li><strong>Default</strong>: <code>true</code></li><li><strong>Description</strong>: Whether to enable logging. Must be used with <code>DEBUG</code> log level.</li></ul><h3 id="loggingmaskenabled" tabindex="-1"><a class="header-anchor" href="#loggingmaskenabled"><span>loggingMaskEnabled</span></a></h3><ul><li><strong>Type</strong>: <code>Boolean</code></li><li><strong>Default</strong>: <code>true</code></li><li><strong>Description</strong>: Whether to enable log masking. Recommended to keep enabled in production to protect sensitive information.</li></ul><h2 id="usage-examples" tabindex="-1"><a class="header-anchor" href="#usage-examples"><span>Usage Examples</span></a></h2><h3 id="example-1-default-configuration-recommended" tabindex="-1"><a class="header-anchor" href="#example-1-default-configuration-recommended"><span>Example 1: Default Configuration (Recommended)</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">dify</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//api.dify.ai</span>
<span class="line">  <span class="token key atrule">client-config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">logging</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">logging-mask-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># Enabled by default, can be omitted</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Log Output Example:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">„ÄêDify„ÄëRequest: POST https://api.dify.ai/v1/chat-messages?api_key=***MASKED***</span>
<span class="line">„ÄêDify„ÄëRequest Headers: {Authorization: ***MASKED***, Content-Type: application/json}</span>
<span class="line">„ÄêDify„ÄëRequest Body: {&quot;query&quot;:&quot;Hello&quot;,&quot;user&quot;:&quot;user-123&quot;}</span>
<span class="line">„ÄêDify„ÄëResponse: 200 OK (123ms)</span>
<span class="line">„ÄêDify„ÄëResponse Headers: {Content-Type: application/json}</span>
<span class="line">„ÄêDify„ÄëResponse Body: {&quot;answer&quot;:&quot;Hello! How can I help you?&quot;}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="example-2-debug-mode-masking-disabled" tabindex="-1"><a class="header-anchor" href="#example-2-debug-mode-masking-disabled"><span>Example 2: Debug Mode (Masking Disabled)</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">dify</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//api.dify.ai</span>
<span class="line">  <span class="token key atrule">client-config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">logging</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">logging-mask-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token comment"># Disable masking for debugging</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Log Output Example:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">„ÄêDify„ÄëRequest: POST https://api.dify.ai/v1/chat-messages?api_key=app-abc123def456</span>
<span class="line">„ÄêDify„ÄëRequest Headers: {Authorization: Bearer app-abc123def456, Content-Type: application/json}</span>
<span class="line">„ÄêDify„ÄëRequest Body: {&quot;query&quot;:&quot;Hello&quot;,&quot;user&quot;:&quot;user-123&quot;}</span>
<span class="line">„ÄêDify„ÄëResponse: 200 OK (123ms)</span>
<span class="line">„ÄêDify„ÄëResponse Headers: {Content-Type: application/json}</span>
<span class="line">„ÄêDify„ÄëResponse Body: {&quot;answer&quot;:&quot;Hello! How can I help you?&quot;}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="example-3-sse-streaming-response" tabindex="-1"><a class="header-anchor" href="#example-3-sse-streaming-response"><span>Example 3: SSE Streaming Response</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">dify</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//api.dify.ai</span>
<span class="line">  <span class="token key atrule">client-config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">logging</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">logging-mask-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Log Output Example:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">„ÄêDify„ÄëRequest: POST https://api.dify.ai/v1/chat-messages</span>
<span class="line">„ÄêDify„ÄëRequest Headers: {Authorization: ***MASKED***, Content-Type: application/json}</span>
<span class="line">„ÄêDify„ÄëRequest Body: {&quot;query&quot;:&quot;Hello&quot;,&quot;response_mode&quot;:&quot;streaming&quot;,&quot;user&quot;:&quot;user-123&quot;}</span>
<span class="line">„ÄêDify„ÄëResponse: 200 OK (45ms)</span>
<span class="line">„ÄêDify„ÄëResponse Headers: {Content-Type: text/event-stream}</span>
<span class="line">„ÄêDify„ÄëSSE response detected, skipping body logging to avoid blocking stream</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="log-level-configuration" tabindex="-1"><a class="header-anchor" href="#log-level-configuration"><span>Log Level Configuration</span></a></h2><p>To enable log output, configure the log level to <code>DEBUG</code>:</p><h3 id="logback-configuration-spring-boot-default" tabindex="-1"><a class="header-anchor" href="#logback-configuration-spring-boot-default"><span>Logback Configuration (Spring Boot Default)</span></a></h3><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml"><pre><code class="language-xml"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.github.guoshiqiufeng.dify.client<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="application-yml-configuration" tabindex="-1"><a class="header-anchor" href="#application-yml-configuration"><span>application.yml Configuration</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">logging</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">level</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">io.github.guoshiqiufeng.dify.client</span><span class="token punctuation">:</span> DEBUG</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="log4j2-configuration" tabindex="-1"><a class="header-anchor" href="#log4j2-configuration"><span>Log4j2 Configuration</span></a></h3><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml"><pre><code class="language-xml"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Loggers</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.github.guoshiqiufeng.dify.client<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Loggers</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Configuration</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="security-best-practices" tabindex="-1"><a class="header-anchor" href="#security-best-practices"><span>Security Best Practices</span></a></h2><h3 id="_1-production-environment-configuration" tabindex="-1"><a class="header-anchor" href="#_1-production-environment-configuration"><span>1. Production Environment Configuration</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">dify</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">client-config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">logging</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>                    <span class="token comment"># Enable logging for troubleshooting</span></span>
<span class="line">    <span class="token key atrule">logging-mask-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>       <span class="token comment"># Must enable masking to protect sensitive info</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-development-environment-configuration" tabindex="-1"><a class="header-anchor" href="#_2-development-environment-configuration"><span>2. Development Environment Configuration</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">dify</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">client-config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">logging</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">logging-mask-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>      <span class="token comment"># Can disable masking for debugging</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-log-level-recommendations" tabindex="-1"><a class="header-anchor" href="#_3-log-level-recommendations"><span>3. Log Level Recommendations</span></a></h3><ul><li><strong>Production</strong>: <code>INFO</code> or <code>WARN</code> (no detailed logs)</li><li><strong>Testing</strong>: <code>DEBUG</code> (detailed logs with masking enabled)</li><li><strong>Development</strong>: <code>DEBUG</code> (detailed logs, masking optional)</li></ul><h3 id="_4-sensitive-information-handling" tabindex="-1"><a class="header-anchor" href="#_4-sensitive-information-handling"><span>4. Sensitive Information Handling</span></a></h3><ul><li>‚úÖ <strong>Recommended</strong>: Use environment variables or configuration center for API Keys</li><li>‚úÖ <strong>Recommended</strong>: Enable log masking</li><li>‚úÖ <strong>Recommended</strong>: Regularly review log output to ensure no sensitive information leakage</li><li>‚ùå <strong>Avoid</strong>: Hard-coding API Keys in code</li><li>‚ùå <strong>Avoid</strong>: Committing log files with sensitive information to version control</li></ul><h2 id="technical-implementation" tabindex="-1"><a class="header-anchor" href="#technical-implementation"><span>Technical Implementation</span></a></h2><h3 id="masking-mechanism" tabindex="-1"><a class="header-anchor" href="#masking-mechanism"><span>Masking Mechanism</span></a></h3><p>The framework uses <code>MaskingEngine</code> for intelligent masking:</p><ol><li><strong>Header Masking</strong>: Detects header names, masks if matching sensitive keywords</li><li><strong>URL Parameter Masking</strong>: Uses regex to match sensitive parameter names</li><li><strong>Body Masking</strong>: Uses lightweight Tokenizer to parse JSON/form data and identify sensitive fields</li></ol><h3 id="sse-detection" tabindex="-1"><a class="header-anchor" href="#sse-detection"><span>SSE Detection</span></a></h3><p>Determines if response is SSE by checking <code>Content-Type</code> header:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isSseResponse</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span> contentType<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>contentType <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>contentType<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;event-stream&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>contentType<span class="token punctuation">.</span><span class="token function">subtype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="performance-impact" tabindex="-1"><a class="header-anchor" href="#performance-impact"><span>Performance Impact</span></a></h3><ul><li>Log masking only executes at <code>DEBUG</code> level</li><li>In production with <code>INFO</code> level, masking logic is not executed</li><li>Masking operations use efficient regex and string operations, negligible performance impact</li></ul><h2 id="faq" tabindex="-1"><a class="header-anchor" href="#faq"><span>FAQ</span></a></h2><h3 id="q1-how-to-temporarily-disable-masking-for-debugging" tabindex="-1"><a class="header-anchor" href="#q1-how-to-temporarily-disable-masking-for-debugging"><span>Q1: How to temporarily disable masking for debugging?</span></a></h3><p><strong>A:</strong> Set <code>logging-mask-enabled: false</code> in configuration:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">dify</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">client-config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">logging-mask-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="q2-does-masking-affect-actual-api-calls" tabindex="-1"><a class="header-anchor" href="#q2-does-masking-affect-actual-api-calls"><span>Q2: Does masking affect actual API calls?</span></a></h3><p><strong>A:</strong> No. Masking only affects log output and does not modify actual request and response data.</p><h3 id="q3-how-to-customize-masking-rules" tabindex="-1"><a class="header-anchor" href="#q3-how-to-customize-masking-rules"><span>Q3: How to customize masking rules?</span></a></h3><p><strong>A:</strong> Current version uses built-in masking rules. For customization, use <code>LogMaskingUtils.createEngine()</code> to create a custom MaskingEngine:</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java"><pre><code class="language-java"><span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>guoshiqiufeng<span class="token punctuation">.</span>dify<span class="token punctuation">.</span>core<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>masking<span class="token punctuation">.</span></span><span class="token class-name">MaskingConfig</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>guoshiqiufeng<span class="token punctuation">.</span>dify<span class="token punctuation">.</span>core<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>masking<span class="token punctuation">.</span></span><span class="token class-name">MaskingEngine</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name">MaskingConfig</span> config <span class="token operator">=</span> <span class="token class-name">MaskingConfig</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">addSensitiveField</span><span class="token punctuation">(</span><span class="token string">&quot;custom_field&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">maxBodyLength</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name">MaskingEngine</span> engine <span class="token operator">=</span> <span class="token class-name">LogMaskingUtils</span><span class="token punctuation">.</span><span class="token function">createEngine</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="q4-why-doesn-t-sse-response-log-the-body" tabindex="-1"><a class="header-anchor" href="#q4-why-doesn-t-sse-response-log-the-body"><span>Q4: Why doesn&#39;t SSE response log the body?</span></a></h3><p><strong>A:</strong> SSE is a streaming response. Reading the body would block stream consumption, causing:</p><ul><li>Client cannot receive data in real-time</li><li>Potential memory overflow (large streaming responses)</li><li>Connection timeout</li></ul><p>Therefore, SSE responses only log headers, not body.</p><h3 id="q5-how-to-verify-masking-is-working" tabindex="-1"><a class="header-anchor" href="#q5-how-to-verify-masking-is-working"><span>Q5: How to verify masking is working?</span></a></h3><p><strong>A:</strong></p><ol><li>Configure log level to <code>DEBUG</code></li><li>Enable <code>logging-mask-enabled: true</code></li><li>Make a request with sensitive information</li><li>Check log output, sensitive info should show as <code>***MASKED***</code></li></ol><h2 id="version-history" tabindex="-1"><a class="header-anchor" href="#version-history"><span>Version History</span></a></h2><ul><li><strong>v2.1.0</strong>: Enhanced log masking, added SSE safety protection</li><li><strong>v2.0.0</strong>: Introduced MaskingEngine with intelligent masking</li><li><strong>v1.x</strong>: Basic logging functionality</li></ul><h2 id="related-documentation" tabindex="-1"><a class="header-anchor" href="#related-documentation"><span>Related Documentation</span></a></h2>`,78)),s("ul",null,[s("li",null,[e(a,{to:"/en/guide/introduction.html"},{default:t(()=>[...n[0]||(n[0]=[i("Configuration",-1)])]),_:1})]),s("li",null,[e(a,{to:"/en/config/custom.html"},{default:t(()=>[...n[1]||(n[1]=[i("Custom Configuration",-1)])]),_:1})]),s("li",null,[e(a,{to:"/en/guide/status.html"},{default:t(()=>[...n[2]||(n[2]=[i("Status Monitoring",-1)])]),_:1})])])])}const k=o(r,[["render",d]]),h=JSON.parse('{"path":"/en/guide/logging-security.html","title":"Logging Security","lang":"en-US","frontmatter":{"lang":"en-US","title":"Logging Security","description":"Log masking and SSE safety hardening"},"git":{"updatedTime":1770264311000,"contributors":[{"name":"yanghq","username":"yanghq","email":"1040926235@qq.com","commits":1,"url":"https://github.com/yanghq"}],"changelog":[{"hash":"2830fb5d387ebe512bd2d863af74247b19bdea1f","time":1770264311000,"email":"1040926235@qq.com","author":"yanghq","message":"feat(security): enhance log masking and SSE safety"}]},"filePathRelative":"en/guide/logging-security.md"}');export{k as comp,h as data};
